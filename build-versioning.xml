<?xml version="1.0" encoding="UTF-8"?>
<project name="DMDirc-versioning" default="default" basedir=".">
    <description>Adds automatic versioning information to DMDirc</description>

    <property name="version.config" value="build/classes/com/dmdirc/version.config"/>

    <available file=".git" property="is.git"/>
    <available file=".svn" property="is.svn"/>

    <target name="-write-version" depends="-write-version-header, -add-version, -write-updater-header, -add-channel"/>

    <target name="-write-version-header">
        <echo file="${version.config}"># This is a DMDirc configuration file automatically generated by
# the build process.

keysections:
   identity
   version
   updater

identity:
   name=DMDirc version information
   globaldefault=true
   order=95000

version:
   version=</echo>
    </target>

    <target name="-add-version" depends="-add-git-version, -add-svn-version"/>

    <target name="-add-git-version" if="is.git">
        <exec executable="git-describe" output="${version.config}" append="true">
            <arg value="--tags"/>
        </exec>
    </target>

    <target name="-add-svn-version" if="is.svn">
        <exec dir="." executable="/bin/bash" output="${version.config}" append="true">
            <arg value="-c"/>
            <arg value="svn log -l 1 | grep ^Git-version | cut -f 2 -d ' '"/>
        </exec>
    </target>

    <target name="-write-updater-header">
        <echo file="${version.config}" append="true">
updater:
    channel=</echo>
    </target>

    <target name="-init-channel" unless="channel">
        <property name="channel" value="NONE"/>
    </target>

    <target name="-add-channel" depends="-init-channel">
        <echo file="${version.config}" append="true">${channel}</echo>
    </target>

</project>
